(function(p,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports):"function"===typeof define&&define.amd?define(["exports"],t):t((p.Leaflet=p.Leaflet||{},p.Leaflet.markercluster=p.Leaflet.markercluster||{}))})(this,function(p){var t=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,
removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(a){L.Util.setOptions(this,a);this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction);this._featureGroup=L.featureGroup();this._featureGroup.addEventParent(this);this._nonPointGroup=L.featureGroup();
this._nonPointGroup.addEventParent(this);this._inZoomAnimation=0;this._needsClustering=[];this._needsRemoving=[];this._currentShownBounds=null;this._queue=[];this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};a=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,a?this._withAnimation:this._noAnimation);this._markerCluster=a?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(a){if(a instanceof L.LayerGroup)return this.addLayers([a]);
if(!a.getLatLng)return this._nonPointGroup.addLayer(a),this.fire("layeradd",{layer:a}),this;if(!this._map)return this._needsClustering.push(a),this.fire("layeradd",{layer:a}),this;if(this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy();this._addLayer(a,this._maxZoom);this.fire("layeradd",{layer:a});this._topClusterLevel._recalculateBounds();this._refreshClustersIcons();var b=a,c=this._zoom;if(a.__parent)for(;b.__parent._zoom>=c;)b=b.__parent;this._currentShownBounds.contains(b.getLatLng())&&
(this.options.animateAddingMarkers?this._animationAddLayer(a,b):this._animationAddLayerNonAnimated(a,b));return this},removeLayer:function(a){if(a instanceof L.LayerGroup)return this.removeLayers([a]);if(!a.getLatLng)return this._nonPointGroup.removeLayer(a),this.fire("layerremove",{layer:a}),this;if(!this._map)return!this._arraySplice(this._needsClustering,a)&&this.hasLayer(a)&&this._needsRemoving.push({layer:a,latlng:a._latlng}),this.fire("layerremove",{layer:a}),this;if(!a.__parent)return this;
this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a));this._removeLayer(a,!0);this.fire("layerremove",{layer:a});this._topClusterLevel._recalculateBounds();this._refreshClustersIcons();a.off(this._childMarkerEventHandlers,this);this._featureGroup.hasLayer(a)&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow());return this},addLayers:function(a,b){if(!L.Util.isArray(a))return this.addLayer(a);var c=this._featureGroup,d=this._nonPointGroup,e=this.options.chunkedLoading,f=this.options.chunkInterval,
g=this.options.chunkProgress,k=a.length,h=0,l=!0;if(this._map){var n=(new Date).getTime(),r=L.bind(function(){for(var q=(new Date).getTime();h<k&&!(e&&0===h%200&&(new Date).getTime()-q>f);h++)if(m=a[h],m instanceof L.LayerGroup)l&&(a=a.slice(),l=!1),this._extractNonGroupLayers(m,a),k=a.length;else if(!m.getLatLng)d.addLayer(m),b||this.fire("layeradd",{layer:m});else if(!this.hasLayer(m)&&(this._addLayer(m,this._maxZoom),b||this.fire("layeradd",{layer:m}),m.__parent&&2===m.__parent.getChildCount())){var p=
m.__parent.getAllChildMarkers();c.removeLayer(p[0]===m?p[1]:p[0])}g&&g(h,k,(new Date).getTime()-n);h===k?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(r,this.options.chunkDelay)},this);r()}else for(var q=this._needsClustering;h<k;h++){var m=a[h];m instanceof L.LayerGroup?(l&&(a=a.slice(),l=!1),this._extractNonGroupLayers(m,a),k=a.length):m.getLatLng?this.hasLayer(m)||
q.push(m):d.addLayer(m)}return this},removeLayers:function(a){var b,c=a.length,d=this._featureGroup,e=this._nonPointGroup,f=!0;if(!this._map){for(b=0;b<c;b++){var g=a[b];g instanceof L.LayerGroup?(f&&(a=a.slice(),f=!1),this._extractNonGroupLayers(g,a),c=a.length):(this._arraySplice(this._needsClustering,g),e.removeLayer(g),this.hasLayer(g)&&this._needsRemoving.push({layer:g,latlng:g._latlng}),this.fire("layerremove",{layer:g}))}return this}if(this._unspiderfy){this._unspiderfy();var k=a.slice(),h=
c;for(b=0;b<h;b++)g=k[b],g instanceof L.LayerGroup?(this._extractNonGroupLayers(g,k),h=k.length):this._unspiderfyLayer(g)}for(b=0;b<c;b++)g=a[b],g instanceof L.LayerGroup?(f&&(a=a.slice(),f=!1),this._extractNonGroupLayers(g,a),c=a.length):g.__parent?(this._removeLayer(g,!0,!0),this.fire("layerremove",{layer:g}),d.hasLayer(g)&&(d.removeLayer(g),g.clusterShow&&g.clusterShow())):(e.removeLayer(g),this.fire("layerremove",{layer:g}));this._topClusterLevel._recalculateBounds();this._refreshClustersIcons();
this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds);return this},clearLayers:function(){this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered);this._noanimationUnspiderfy&&this._noanimationUnspiderfy();this._featureGroup.clearLayers();this._nonPointGroup.clearLayers();this.eachLayer(function(a){a.off(this._childMarkerEventHandlers,this);delete a.__parent},this);this._map&&this._generateInitialClusters();
return this},getBounds:function(){var a=new L.LatLngBounds;this._topClusterLevel&&a.extend(this._topClusterLevel._bounds);for(var b=this._needsClustering.length-1;0<=b;b--)a.extend(this._needsClustering[b].getLatLng());a.extend(this._nonPointGroup.getBounds());return a},eachLayer:function(a,b){var c=this._needsClustering.slice(),d=this._needsRemoving,e,f;this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(c);for(e=c.length-1;0<=e;e--){var g=!0;for(f=d.length-1;0<=f;f--)if(d[f].layer===
c[e]){g=!1;break}g&&a.call(b,c[e])}this._nonPointGroup.eachLayer(a,b)},getLayers:function(){var a=[];this.eachLayer(function(b){a.push(b)});return a},getLayer:function(a){var b=null;a=parseInt(a,10);this.eachLayer(function(c){L.stamp(c)===a&&(b=c)});return b},hasLayer:function(a){if(!a)return!1;var b,c=this._needsClustering;for(b=c.length-1;0<=b;b--)if(c[b]===a)return!0;c=this._needsRemoving;for(b=c.length-1;0<=b;b--)if(c[b].layer===a)return!1;return!(!a.__parent||a.__parent._group!==this)||this._nonPointGroup.hasLayer(a)},
zoomToShowLayer:function(a,b){"function"!==typeof b&&(b=function(){});var c=function(){!a._icon&&!a.__parent._icon||this._inZoomAnimation||(this._map.off("moveend",c,this),this.off("animationend",c,this),a._icon?b():a.__parent._icon&&(this.once("spiderfied",b,this),a.__parent.spiderfy()))};a._icon&&this._map.getBounds().contains(a.getLatLng())?b():a.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",c,this),this._map.panTo(a.getLatLng())):(this._map.on("moveend",c,this),this.on("animationend",
c,this),a.__parent.zoomToBounds())},onAdd:function(a){this._map=a;var b;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";this._featureGroup.addTo(a);this._nonPointGroup.addTo(a);this._gridClusters||this._generateInitialClusters();this._maxLat=a.options.crs.projection.MAX_LATITUDE;a=0;for(b=this._needsRemoving.length;a<b;a++){var c=this._needsRemoving[a];c.newlatlng=c.layer._latlng;c.layer._latlng=c.latlng}a=0;for(b=this._needsRemoving.length;a<b;a++)c=this._needsRemoving[a],
this._removeLayer(c.layer,!0),c.layer._latlng=c.newlatlng;this._needsRemoving=[];this._zoom=Math.round(this._map._zoom);this._currentShownBounds=this._getExpandedVisibleBounds();this._map.on("zoomend",this._zoomEnd,this);this._map.on("moveend",this._moveEnd,this);this._spiderfierOnAdd&&this._spiderfierOnAdd();this._bindEvents();b=this._needsClustering;this._needsClustering=[];this.addLayers(b,!0)},onRemove:function(a){a.off("zoomend",this._zoomEnd,this);a.off("moveend",this._moveEnd,this);this._unbindEvents();
this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","");this._spiderfierOnRemove&&this._spiderfierOnRemove();delete this._maxLat;this._hideCoverage();this._featureGroup.remove();this._nonPointGroup.remove();this._featureGroup.clearLayers();this._map=null},getVisibleParent:function(a){for(;a&&!a._icon;)a=a.__parent;return a||null},_arraySplice:function(a,b){for(var c=a.length-1;0<=c;c--)if(a[c]===b)return a.splice(c,1),!0},_removeFromGridUnclustered:function(a,
b){for(var c=this._map,d=this._gridUnclustered,e=Math.floor(this._map.getMinZoom());b>=e&&d[b].removeObject(a,c.project(a.getLatLng(),b));b--);},_childMarkerDragStart:function(a){a.target.__dragStart=a.target._latlng},_childMarkerMoved:function(a){if(!this._ignoreMove&&!a.target.__dragStart){var b=a.target._popup&&a.target._popup.isOpen();this._moveChild(a.target,a.oldLatLng,a.latlng);b&&a.target.openPopup()}},_moveChild:function(a,b,c){a._latlng=b;this.removeLayer(a);a._latlng=c;this.addLayer(a)},
_childMarkerDragEnd:function(a){var b=a.target.__dragStart;delete a.target.__dragStart;b&&this._moveChild(a.target,b,a.target._latlng)},_removeLayer:function(a,b,c){var d=this._gridClusters,e=this._gridUnclustered,f=this._featureGroup,g=this._map,k=Math.floor(this._map.getMinZoom());b&&this._removeFromGridUnclustered(a,this._maxZoom);var h=a.__parent;for(this._arraySplice(h._markers,a);h;){h._childCount--;h._boundsNeedUpdate=!0;if(h._zoom<k)break;else if(b&&1>=h._childCount){var l=h._markers[0]===
a?h._markers[1]:h._markers[0];d[h._zoom].removeObject(h,g.project(h._cLatLng,h._zoom));e[h._zoom].addObject(l,g.project(l.getLatLng(),h._zoom));this._arraySplice(h.__parent._childClusters,h);h.__parent._markers.push(l);l.__parent=h.__parent;h._icon&&(f.removeLayer(h),c||f.addLayer(l))}else h._iconNeedsUpdate=!0;h=h.__parent}delete a.__parent},_isOrIsParent:function(a,b){for(;b;){if(a===b)return!0;b=b.parentNode}return!1},fire:function(a,b,c){if(b&&b.layer instanceof L.MarkerCluster){if(b.originalEvent&&
this._isOrIsParent(b.layer._icon,b.originalEvent.relatedTarget))return;a="cluster"+a}L.FeatureGroup.prototype.fire.call(this,a,b,c)},listens:function(a,b){return L.FeatureGroup.prototype.listens.call(this,a,b)||L.FeatureGroup.prototype.listens.call(this,"cluster"+a,b)},_defaultIconCreateFunction:function(a){a=a.getChildCount();var b=" marker-cluster-";return new L.DivIcon({html:"<div><span>"+a+"</span></div>",className:"marker-cluster"+(10>a?b+"small":100>a?b+"medium":b+"large"),iconSize:new L.Point(40,
40)})},_bindEvents:function(){var a=this._map,b=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick;if(this.options.spiderfyOnMaxZoom||c)this.on("clusterclick",this._zoomOrSpiderfy,this);b&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),a.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(a){for(var b=a.layer,c=b;1===c._childClusters.length;)c=c._childClusters[0];c._zoom===this._maxZoom&&c._childCount===b._childCount&&
this.options.spiderfyOnMaxZoom?b.spiderfy():this.options.zoomToBoundsOnClick&&b.zoomToBounds();a.originalEvent&&13===a.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(a){var b=this._map;this._inZoomAnimation||(this._shownPolygon&&b.removeLayer(this._shownPolygon),2<a.layer.getChildCount()&&a.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions),b.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&
(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var a=this.options.showCoverageOnHover,b=this.options.zoomToBoundsOnClick,c=this._map;(this.options.spiderfyOnMaxZoom||b)&&this.off("clusterclick",this._zoomOrSpiderfy,this);a&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),c.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),
this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,a);this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),a);this._currentShownBounds=a}},_generateInitialClusters:function(){var a=Math.ceil(this._map.getMaxZoom()),b=Math.floor(this._map.getMinZoom()),
c=this.options.maxClusterRadius,d=c;"function"!==typeof c&&(d=function(){return c});null!==this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1);this._maxZoom=a;this._gridClusters={};for(this._gridUnclustered={};a>=b;a--)this._gridClusters[a]=new L.DistanceGrid(d(a)),this._gridUnclustered[a]=new L.DistanceGrid(d(a));this._topClusterLevel=new this._markerCluster(this,b-1)},_addLayer:function(a,b){var c=this._gridClusters,d=this._gridUnclustered,e=Math.floor(this._map.getMinZoom());
this.options.singleMarkerMode&&this._overrideMarkerIcon(a);for(a.on(this._childMarkerEventHandlers,this);b>=e;b--){var f=this._map.project(a.getLatLng(),b);var g=c[b].getNearObject(f);if(g){g._addChild(a);a.__parent=g;return}if(g=d[b].getNearObject(f)){(d=g.__parent)&&this._removeLayer(g,!1);e=new this._markerCluster(this,b,g,a);c[b].addObject(e,this._map.project(e._cLatLng,b));g.__parent=e;a.__parent=e;for(a=b-1;a>d._zoom;a--)e=new this._markerCluster(this,a,e),c[a].addObject(e,this._map.project(g.getLatLng(),
a));d._addChild(e);this._removeFromGridUnclustered(g,b);return}d[b].addObject(a,f)}this._topClusterLevel._addChild(a);a.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(a){a instanceof L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()})},_enqueue:function(a){this._queue.push(a);this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var a=0;a<this._queue.length;a++)this._queue[a].call(this);
this._queue.length=0;clearTimeout(this._queueTimeout);this._queueTimeout=null},_mergeSplitClusters:function(){var a=Math.round(this._map._zoom);this._processQueue();this._zoom<a&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,a)):this._zoom>a?(this._animationStart(),
this._animationZoomOut(this._zoom,a)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(a){var b=this._maxLat;void 0!==b&&(a.getNorth()>=b&&(a._northEast.lat=Infinity),a.getSouth()<=-b&&(a._southWest.lat=-Infinity));return a},_animationAddLayerNonAnimated:function(a,b){b===a?this._featureGroup.addLayer(a):
2===b._childCount?(b._addToMap(),a=b.getAllChildMarkers(),this._featureGroup.removeLayer(a[0]),this._featureGroup.removeLayer(a[1])):b._updateIcon()},_extractNonGroupLayers:function(a,b){a=a.getLayers();var c=0;for(b=b||[];c<a.length;c++){var d=a[c];d instanceof L.LayerGroup?this._extractNonGroupLayers(d,b):b.push(d)}return b},_overrideMarkerIcon:function(a){return a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}})}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-Infinity,
-Infinity),new L.LatLng(Infinity,Infinity))});L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),a);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds());this.fire("animationend")},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,
Math.floor(this._map.getMinZoom()),a);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds());this.fire("animationend")},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim";this._inZoomAnimation++},_animationZoomIn:function(a,b){var c=this._getExpandedVisibleBounds(),d=this._featureGroup,e=Math.floor(this._map.getMinZoom()),f;this._ignoreMove=
!0;this._topClusterLevel._recursively(c,a,e,function(g){var e=g._latlng,h=g._markers;c.contains(e)||(e=null);g._isSingleParent()&&a+1===b?(d.removeLayer(g),g._recursivelyAddChildrenToMap(null,b,c)):(g.clusterHide(),g._recursivelyAddChildrenToMap(e,b,c));for(f=h.length-1;0<=f;f--)g=h[f],c.contains(g._latlng)||d.removeLayer(g)});this._forceLayout();this._topClusterLevel._recursivelyBecomeVisible(c,b);d.eachLayer(function(a){a instanceof L.MarkerCluster||!a._icon||a.clusterShow()});this._topClusterLevel._recursively(c,
a,b,function(a){a._recursivelyRestoreChildPositions(b)});this._ignoreMove=!1;this._enqueue(function(){this._topClusterLevel._recursively(c,a,e,function(a){d.removeLayer(a);a.clusterShow()});this._animationEnd()})},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b);this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds());this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),
a,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){var c=this,d=this._featureGroup;d.addLayer(a);b!==a&&(2<b._childCount?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.clusterHide(),this._enqueue(function(){d.removeLayer(a);a.clusterShow();c._animationEnd()})):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(a,b,c){var d=
this._getExpandedVisibleBounds(),e=Math.floor(this._map.getMinZoom());a._recursivelyAnimateChildrenInAndAddSelfToMap(d,e,b+1,c);var f=this;this._forceLayout();a._recursivelyBecomeVisible(d,c);this._enqueue(function(){if(1===a._childCount){var g=a._markers[0];this._ignoreMove=!0;g.setLatLng(g.getLatLng());this._ignoreMove=!1;g.clusterShow&&g.clusterShow()}else a._recursively(d,c,e,function(a){a._recursivelyRemoveChildrenFromMap(d,e,b+1)});f._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=
this._map._mapPane.className.replace(" leaflet-cluster-anim",""));this._inZoomAnimation--;this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}});L.markerClusterGroup=function(a){return new L.MarkerClusterGroup(a)};var u=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(a,b,c,d){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this,pane:a.options.clusterPane});this._group=a;this._zoom=
b;this._markers=[];this._childClusters=[];this._childCount=0;this._boundsNeedUpdate=this._iconNeedsUpdate=!0;this._bounds=new L.LatLngBounds;c&&this._addChild(c);d&&this._addChild(d)},getAllChildMarkers:function(a,b){a=a||[];for(var c=this._childClusters.length-1;0<=c;c--)this._childClusters[c].getAllChildMarkers(a);for(c=this._markers.length-1;0<=c;c--)b&&this._markers[c].__dragStart||a.push(this._markers[c]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(a){var b=
this._childClusters.slice(),c=this._group._map,d=c.getBoundsZoom(this._bounds),e=this._zoom+1;c=c.getZoom();for(var f;0<b.length&&d>e;){e++;var g=[];for(f=0;f<b.length;f++)g=g.concat(b[f]._childClusters);b=g}d>e?this._group._map.setView(this._latlng,e):d<=c?this._group._map.setView(this._latlng,c+1):this._group._map.fitBounds(this._bounds,a)},getBounds:function(){var a=new L.LatLngBounds;a.extend(this._bounds);return a},_updateIcon:function(){this._iconNeedsUpdate=!0;this._icon&&this.setIcon(this)},
createIcon:function(){this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1);return this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,b){this._boundsNeedUpdate=this._iconNeedsUpdate=!0;this._setClusterCenter(a);a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++);this.__parent&&this.__parent._addChild(a,
!0)},_setClusterCenter:function(a){this._cLatLng||(this._cLatLng=a._cLatLng||a._latlng)},_resetBounds:function(){var a=this._bounds;a._southWest&&(a._southWest.lat=Infinity,a._southWest.lng=Infinity);a._northEast&&(a._northEast.lat=-Infinity,a._northEast.lng=-Infinity)},_recalculateBounds:function(){var a=this._markers,b=this._childClusters,c=0,d=0,e=this._childCount,f;if(0!==e){this._resetBounds();for(f=0;f<a.length;f++){var g=a[f]._latlng;this._bounds.extend(g);c+=g.lat;d+=g.lng}for(f=0;f<b.length;f++)a=
b[f],a._boundsNeedUpdate&&a._recalculateBounds(),this._bounds.extend(a._bounds),g=a._wLatLng,a=a._childCount,c+=g.lat*a,d+=g.lng*a;this._latlng=this._wLatLng=new L.LatLng(c/e,d/e);this._boundsNeedUpdate=!1}},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a));this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,this._group._map.getMinZoom(),c-1,function(a){a=a._markers;var c;for(c=a.length-1;0<=c;c--){var d=a[c];d._icon&&
(d._setPos(b),d.clusterHide())}},function(a){a=a._childClusters;var c;for(c=a.length-1;0<=c;c--){var d=a[c];d._icon&&(d._setPos(b),d.clusterHide())}})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c,d){this._recursively(a,d,b,function(e){e._recursivelyAnimateChildrenIn(a,e._group._map.latLngToLayerPoint(e.getLatLng()).round(),c);e._isSingleParent()&&c-1===d?(e.clusterShow(),e._recursivelyRemoveChildrenFromMap(a,b,c)):e.clusterHide();e._addToMap()})},_recursivelyBecomeVisible:function(a,
b){this._recursively(a,this._group._map.getMinZoom(),b,null,function(a){a.clusterShow()})},_recursivelyAddChildrenToMap:function(a,b,c){this._recursively(c,this._group._map.getMinZoom()-1,b,function(d){if(b!==d._zoom)for(var e=d._markers.length-1;0<=e;e--){var f=d._markers[e];c.contains(f._latlng)&&(a&&(f._backupLatlng=f.getLatLng(),f.setLatLng(a),f.clusterHide&&f.clusterHide()),d._group._featureGroup.addLayer(f))}},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b=
this._markers.length-1;0<=b;b--){var c=this._markers[b];c._backupLatlng&&(c.setLatLng(c._backupLatlng),delete c._backupLatlng)}if(a-1===this._zoom)for(a=this._childClusters.length-1;0<=a;a--)this._childClusters[a]._restorePosition();else for(b=this._childClusters.length-1;0<=b;b--)this._childClusters[b]._recursivelyRestoreChildPositions(a)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,
c,d){var e,f;this._recursively(a,b-1,c-1,function(a){for(f=a._markers.length-1;0<=f;f--)e=a._markers[f],d&&d.contains(e._latlng)||(a._group._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow())},function(a){for(f=a._childClusters.length-1;0<=f;f--)e=a._childClusters[f],d&&d.contains(e._latlng)||(a._group._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow())})},_recursively:function(a,b,c,d,e){var f=this._childClusters,g=this._zoom;b<=g&&(d&&d(this),e&&g===c&&e(this));if(g<b||g<c)for(g=
f.length-1;0<=g;g--){var k=f[g];k._boundsNeedUpdate&&k._recalculateBounds();a.intersects(k._bounds)&&k._recursively(a,b,c,d,e)}},_isSingleParent:function(){return 0<this._childClusters.length&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var a=this.options.opacity;this.setOpacity(0);this.options.opacity=a;return this},clusterShow:function(){return this.setOpacity(this.options.opacity)}});L.DistanceGrid=function(a){this._cellSize=a;this._sqCellSize=
a*a;this._grid={};this._objectPoint={}};L.DistanceGrid.prototype={addObject:function(a,b){var c=this._getCoord(b.x),d=this._getCoord(b.y),e=this._grid;d=e[d]=e[d]||{};c=d[c]=d[c]||[];d=L.Util.stamp(a);this._objectPoint[d]=b;c.push(a)},updateObject:function(a,b){this.removeObject(a);this.addObject(a,b)},removeObject:function(a,b){var c=this._getCoord(b.x);b=this._getCoord(b.y);var d=this._grid;b=d[b]=d[b]||{};d=b[c]=b[c]||[];var e;delete this._objectPoint[L.Util.stamp(a)];var f=0;for(e=d.length;f<
e;f++)if(d[f]===a)return d.splice(f,1),1===e&&delete b[c],!0},eachObject:function(a,b){var c,d,e,f,g=this._grid;for(c in g){var k=g[c];for(d in k){var h=k[d];var l=0;for(e=h.length;l<e;l++)if(f=a.call(b,h[l]))l--,e--}}},getNearObject:function(a){var b=this._getCoord(a.x),c=this._getCoord(a.y),d,e,f,g,k,h=this._objectPoint,l=this._sqCellSize,n=null;for(d=c-1;d<=c+1;d++)if(f=this._grid[d])for(e=b-1;e<=b+1;e++)if(g=f[e]){var r=0;for(k=g.length;r<k;r++){var q=g[r];var m=this._sqDist(h[L.Util.stamp(q)],
a);if(m<l||m<=l&&null===n)l=m,n=q}}return n},_getCoord:function(a){var b=Math.floor(a/this._cellSize);return isFinite(b)?b:a},_sqDist:function(a,b){var c=b.x-a.x;a=b.y-a.y;return c*c+a*a}};(function(){L.QuickHull={getDistant:function(a,b){return(b[0].lng-b[1].lng)*(a.lat-b[0].lat)+(b[1].lat-b[0].lat)*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(a,b){var c=0,d=null,e=[],f;for(f=b.length-1;0<=f;f--){var g=b[f];var k=this.getDistant(g,a);0<k&&(e.push(g),k>c&&(c=k,d=g))}return{maxPoint:d,
newPoints:e}},buildConvexHull:function(a,b){var c=[];b=this.findMostDistantPointFromBaseLine(a,b);return b.maxPoint?(c=c.concat(this.buildConvexHull([a[0],b.maxPoint],b.newPoints)),c=c.concat(this.buildConvexHull([b.maxPoint,a[1]],b.newPoints))):[a[0]]},getConvexHull:function(a){var b=!1,c=!1,d=!1,e=!1,f=null,g=null,k=null,h=null,l;for(l=a.length-1;0<=l;l--){var n=a[l];if(!1===b||n.lat>b)f=n,b=n.lat;if(!1===c||n.lat<c)g=n,c=n.lat;if(!1===d||n.lng>d)k=n,d=n.lng;if(!1===e||n.lng<e)h=n,e=n.lng}c!==b?
b=g:(b=h,f=k);return[].concat(this.buildConvexHull([b,f],a),this.buildConvexHull([f,b],a))}}})();L.MarkerCluster.include({getConvexHull:function(){var a=this.getAllChildMarkers(),b=[],c;for(c=a.length-1;0<=c;c--){var d=a[c].getLatLng();b.push(d)}return L.QuickHull.getConvexHull(b)}});L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==
this&&!this._group._inZoomAnimation){var a=this.getAllChildMarkers(null,!0),b=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy();this._group._spiderfied=this;a.length>=this._circleSpiralSwitchover?b=this._generatePointsSpiral(a.length,b):(b.y+=10,b=this._generatePointsCircle(a.length,b));this._animationSpiderfy(a,b)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(a,b){var c=
this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+a)/this._2PI,d=this._2PI/a,e=[],f;c=Math.max(c,35);e.length=a;for(f=0;f<a;f++){var g=this._circleStartAngle+f*d;e[f]=(new L.Point(b.x+c*Math.cos(g),b.y+c*Math.sin(g)))._round()}return e},_generatePointsSpiral:function(a,b){var c=this._group.options.spiderfyDistanceMultiplier,d=c*this._spiralLengthStart,e=c*this._spiralFootSeparation;c=c*this._spiralLengthFactor*this._2PI;var f=0,g=[],k;for(k=g.length=a;0<=k;k--)k<a&&(g[k]=
(new L.Point(b.x+d*Math.cos(f),b.y+d*Math.sin(f)))._round()),f+=e/d+5E-4*k,d+=c/f;return g},_noanimationUnspiderfy:function(){var a=this._group,b=a._map,c=a._featureGroup,d=this.getAllChildMarkers(null,!0),e;a._ignoreMove=!0;this.setOpacity(1);for(e=d.length-1;0<=e;e--){var f=d[e];c.removeLayer(f);f._preSpiderfyLatlng&&(f.setLatLng(f._preSpiderfyLatlng),delete f._preSpiderfyLatlng);f.setZIndexOffset&&f.setZIndexOffset(0);f._spiderLeg&&(b.removeLayer(f._spiderLeg),delete f._spiderLeg)}a.fire("unspiderfied",
{cluster:this,markers:d});a._ignoreMove=!1;a._spiderfied=null}});L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(a,b){var c=this._group,d=c._map,e=c._featureGroup,f=this._group.options.spiderLegPolylineOptions,g;c._ignoreMove=!0;for(g=0;g<a.length;g++){var k=d.layerPointToLatLng(b[g]);var h=a[g];var l=new L.Polyline([this._latlng,k],f);d.addLayer(l);h._spiderLeg=l;h._preSpiderfyLatlng=h._latlng;h.setLatLng(k);h.setZIndexOffset&&h.setZIndexOffset(1E6);e.addLayer(h)}this.setOpacity(.3);
c._ignoreMove=!1;c.fire("spiderfied",{cluster:this,markers:a})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}});L.MarkerCluster.include({_animationSpiderfy:function(a,b){var c=this,d=this._group,e=d._map,f=d._featureGroup,g=this._latlng,k=e.latLngToLayerPoint(g),h=L.Path.SVG,l=L.extend({},this._group.options.spiderLegPolylineOptions),n=l.opacity,r;void 0===n&&(n=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity);h?(l.opacity=0,l.className=(l.className||"")+" leaflet-cluster-spider-leg"):
l.opacity=n;d._ignoreMove=!0;for(r=0;r<a.length;r++){var q=a[r];var m=e.layerPointToLatLng(b[r]);var p=new L.Polyline([g,m],l);e.addLayer(p);q._spiderLeg=p;h&&(m=p._path,p=m.getTotalLength()+.1,m.style.strokeDasharray=p,m.style.strokeDashoffset=p);q.setZIndexOffset&&q.setZIndexOffset(1E6);q.clusterHide&&q.clusterHide();f.addLayer(q);q._setPos&&q._setPos(k)}d._forceLayout();d._animationStart();for(r=a.length-1;0<=r;r--)m=e.layerPointToLatLng(b[r]),q=a[r],q._preSpiderfyLatlng=q._latlng,q.setLatLng(m),
q.clusterShow&&q.clusterShow(),h&&(p=q._spiderLeg,m=p._path,m.style.strokeDashoffset=0,p.setStyle({opacity:n}));this.setOpacity(.3);d._ignoreMove=!1;setTimeout(function(){d._animationEnd();d.fire("spiderfied",{cluster:c,markers:a})},200)},_animationUnspiderfy:function(a){var b=this,c=this._group,d=c._map,e=c._featureGroup;a=a?d._latLngToNewLayerPoint(this._latlng,a.zoom,a.center):d.latLngToLayerPoint(this._latlng);var f=this.getAllChildMarkers(null,!0),g=L.Path.SVG,k;c._ignoreMove=!0;c._animationStart();
this.setOpacity(1);for(k=f.length-1;0<=k;k--){var h=f[k];if(h._preSpiderfyLatlng){h.closePopup();h.setLatLng(h._preSpiderfyLatlng);delete h._preSpiderfyLatlng;var l=!0;h._setPos&&(h._setPos(a),l=!1);h.clusterHide&&(h.clusterHide(),l=!1);l&&e.removeLayer(h);if(g){l=h._spiderLeg;var n=l._path;var p=n.getTotalLength()+.1;n.style.strokeDashoffset=p;l.setStyle({opacity:0})}}}c._ignoreMove=!1;setTimeout(function(){var a=0;for(k=f.length-1;0<=k;k--)h=f[k],h._spiderLeg&&a++;for(k=f.length-1;0<=k;k--)h=f[k],
h._spiderLeg&&(h.clusterShow&&h.clusterShow(),h.setZIndexOffset&&h.setZIndexOffset(0),1<a&&e.removeLayer(h),d.removeLayer(h._spiderLeg),delete h._spiderLeg);c._animationEnd();c.fire("unspiderfied",{cluster:b,markers:f})},200)}});L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this);if(this._map.options.zoomAnimation)this._map.on("zoomstart",this._unspiderfyZoomStart,
this);this._map.on("zoomend",this._noanimationUnspiderfy,this);L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this);this._map.off("zoomstart",this._unspiderfyZoomStart,this);this._map.off("zoomanim",this._unspiderfyZoomAnim,this);this._map.off("zoomend",this._noanimationUnspiderfy,this);this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){if(this._map)this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,
"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(a){a._spiderLeg&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow(),a.setZIndexOffset&&a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),
delete a._spiderLeg)}});L.MarkerClusterGroup.include({refreshClusters:function(a){a?a instanceof L.MarkerClusterGroup?a=a._topClusterLevel.getAllChildMarkers():a instanceof L.LayerGroup?a=a._layers:a instanceof L.MarkerCluster?a=a.getAllChildMarkers():a instanceof L.Marker&&(a=[a]):a=this._topClusterLevel.getAllChildMarkers();this._flagParentsIconsNeedUpdate(a);this._refreshClustersIcons();this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(a);return this},_flagParentsIconsNeedUpdate:function(a){var b,
c;for(b in a)for(c=a[b].__parent;c;)c._iconNeedsUpdate=!0,c=c.__parent},_refreshSingleMarkerModeMarkers:function(a){var b;for(b in a){var c=a[b];this.hasLayer(c)&&c.setIcon(this._overrideMarkerIcon(c))}}});L.Marker.include({refreshIconOptions:function(a,b){var c=this.options.icon;L.setOptions(c,a);this.setIcon(c);b&&this.__parent&&this.__parent._group.refreshClusters(this);return this}});p.MarkerClusterGroup=t;p.MarkerCluster=u});