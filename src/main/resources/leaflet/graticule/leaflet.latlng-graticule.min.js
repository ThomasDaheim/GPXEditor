(function(J,K,M){L.LatLngGraticule=L.Layer.extend({includes:L.Evented.prototype||L.Mixin.Events,options:{showLabel:!0,opacity:1,weight:.8,color:"#aaa",font:"12px Verdana",dashArray:[0,0],lngLineCurved:0,latLineCurved:0,zoomInterval:[{start:2,end:2,interval:40},{start:3,end:3,interval:20},{start:4,end:4,interval:10},{start:5,end:7,interval:5},{start:8,end:20,interval:1}],sides:["N","S","E","W"]},initialize:function(a){L.setOptions(this,a);2>this.options.font.split(" ").length&&(this.options.font+=
" Verdana");this.options.fontColor||(this.options.fontColor=this.options.color);this.options.zoomInterval&&(this.options.zoomInterval.latitude&&(this.options.latInterval=this.options.zoomInterval.latitude,this.options.zoomInterval.longitude||(this.options.lngInterval=this.options.zoomInterval.latitude)),this.options.zoomInterval.longitude&&(this.options.lngInterval=this.options.zoomInterval.longitude,this.options.zoomInterval.latitude||(this.options.latInterval=this.options.zoomInterval.longitude)),
this.options.latInterval||(this.options.latInterval=this.options.zoomInterval),this.options.lngInterval||(this.options.lngInterval=this.options.zoomInterval))},onAdd:function(a){this._map=a;this._canvas||this._initCanvas();a._panes.overlayPane.appendChild(this._canvas);a.on("viewreset",this._reset,this);a.on("move",this._reset,this);a.on("moveend",this._reset,this);if(a.options.zoomAnimation&&L.Browser.any3d)a.on("zoomanim",this._animateZoom,this);this._reset()},onRemove:function(a){L.DomUtil.remove(this._canvas);
a.off("viewreset",this._reset,this);a.off("move",this._reset,this);a.off("moveend",this._reset,this);a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this)},addTo:function(a){a.addLayer(this);return this},setOpacity:function(a){this.options.opacity=a;this._updateOpacity();return this},bringToFront:function(){return this},bringToBack:function(){return this},getAttribution:function(){return this.options.attribution},_initCanvas:function(){this._canvas=L.DomUtil.create("canvas","");this._map.options.zoomAnimation&&
L.Browser.any3d?L.DomUtil.addClass(this._canvas,"leaflet-zoom-animated"):L.DomUtil.addClass(this._canvas,"leaflet-zoom-hide");this._updateOpacity();L.extend(this._canvas,{onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:L.bind(this._onCanvasLoad,this)})},_animateZoom:function(a){var d=this._map,b=this._canvas,k=d.getZoomScale(a.zoom),r=d.containerPointToLatLng([0,0]),z=d.containerPointToLatLng([b.width,b.height]);r=d._latLngToNewLayerPoint(r,a.zoom,a.center);a=d._latLngToNewLayerPoint(z,
a.zoom,a.center)._subtract(r);a=r._add(a._multiplyBy(.5*(1-1/k)));L.DomUtil.setTransform(b,a,k)},_reset:function(){var a=this._canvas,d=this._map.getSize(),b=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(a,b);a.width=d.x;a.height=d.y;a.style.width=d.x+"px";a.style.height=d.y+"px";this.__calcInterval();this.__draw(!0)},_onCanvasLoad:function(){this.fire("load")},_updateOpacity:function(){L.DomUtil.setOpacity(this._canvas,this.options.opacity)},__format_lat:function(a){return this.options.latFormatTickLabel?
this.options.latFormatTickLabel(a):0>a?""+-1*a+this.options.sides[1]:0<a?""+a+this.options.sides[0]:""+a},__format_lng:function(a){return this.options.lngFormatTickLabel?this.options.lngFormatTickLabel(a):180<a?""+(360-a)+this.options.sides[3]:0<a&&180>a?""+a+this.options.sides[2]:0>a&&-180<a?""+-1*a+this.options.sides[3]:-180==a?""+-1*a:-180>a?""+(360+a)+this.options.sides[3]:""+a},__calcInterval:function(){var a=this._map.getZoom();this._currZoom!=a&&(this._currLatInterval=this._currLngInterval=
0,this._currZoom=a);if(!this._currLngInterval)try{for(var d in this.options.lngInterval){var b=this.options.lngInterval[d];if(b.start<=a&&b.end&&b.end>=a){this._currLngInterval=b.interval;break}}}catch(k){this._currLngInterval=0}if(!this._currLatInterval)try{for(d in this.options.latInterval)if(b=this.options.latInterval[d],b.start<=a&&b.end&&b.end>=a){this._currLatInterval=b.interval;break}}catch(k){this._currLatInterval=0}},__draw:function(a){function d(a){2<a.length&&"p"==a.charAt(a.length-2)&&
(a=a.substr(0,a.length-2));try{return parseInt(a,10)}catch(O){}return 0}var b=this._canvas,k=this._map,r=this.options.lngLineCurved,z=this.options.latLineCurved;if(L.Browser.canvas&&k){var G=function(b,d){A=b.__format_lng(d);p=e.measureText(A).width;var g=b._latLngToCanvasPoint(L.latLng(l,d)),f=b.options.showLabel&&a?y+5:0;if(r){"number"==typeof r&&(_lat_delta=r);e.beginPath();e.moveTo(g.x,5+f);g=null;for(var h=l;h<v;h+=_lat_delta){var c=b._latLngToCanvasPoint(L.latLng(h,d));e.lineTo(c.x,c.y-f);b.options.showLabel&&
a&&null!=g&&(8<g.y&&8>=c.y?e.fillText(A,c.x-p/2,y+5):g.y>=w&&c.y<w&&e.fillText(A,c.x-p/2,w-2));g={x:c.x,y:c.y,lon:d,lat:h}}e.stroke()}else c=v,c=b._latLngToCanvasPoint(L.latLng(c,d)),z&&(c=k.containerPointToLatLng(L.point(c.x,0)),c=c.lat,90<c&&(c=90),c=b._latLngToCanvasPoint(L.latLng(c,d)),g=k.containerPointToLatLng(L.point(g.x,w)),g=g.lat,-90>g&&(g=-90),g=b._latLngToCanvasPoint(L.latLng(g,d))),e.beginPath(),e.moveTo(c.x,5+f),e.lineTo(g.x,w-1-f),e.stroke(),b.options.showLabel&&a&&(e.fillText(A,c.x-
p/2,y+5),e.fillText(A,g.x-p/2,w-3))},I=function(b,d){t=b._latLngToCanvasPoint(L.latLng(d,x));B=b.__format_lat(d);p=e.measureText(B).width;var g=b.options.showLabel&&a?p+10:0;if(z){"number"==typeof z&&(H=z);var m=x,h=u;0<t.x&&(m=k.containerPointToLatLng(L.point(0,t.y)),m=m.lng-C,t.x=0);var c=b._latLngToCanvasPoint(L.latLng(d,h));c.x<q&&(h=k.containerPointToLatLng(L.point(q,c.y)),h=h.lng+C,0<m&&0>h&&(h+=360));e.beginPath();e.moveTo(t.x+g,t.y);for(var n=null;m<=h;m+=H){c=b._latLngToCanvasPoint(L.latLng(d,
m));e.lineTo(c.x-g,c.y);if(b.options.showLabel&&a&&null!=n)if(0>n.x&&0<=c.x){var l=(c.x-0)/(c.x-n.x);n=c.y-(c.y-n.y)*l;e.fillText(B,0,n+y/2)}else n.x<=q-p&&c.x>q-p&&(l=(c.x-q)/(c.x-n.x),n=c.y-(c.y-n.y)*l,e.fillText(B,q-p,n+y/2-2));n={x:c.x,y:c.y,lon:m,lat:f}}e.stroke()}else h=u,c=b._latLngToCanvasPoint(L.latLng(d,h)),r&&(h=k.containerPointToLatLng(L.point(0,c.y)),h=h.lng,c=b._latLngToCanvasPoint(L.latLng(d,h)),m=k.containerPointToLatLng(L.point(q,c.y)),m=m.lng,t=b._latLngToCanvasPoint(L.latLng(d,
m))),e.beginPath(),e.moveTo(1+g,t.y),e.lineTo(c.x-1-g,c.y),e.stroke(),b.options.showLabel&&a&&(b=t.y+y/2-2,e.fillText(B,0,b),e.fillText(B,q-p,b))};this._currLngInterval&&this._currLatInterval||this.__calcInterval();var D=this._currLatInterval,E=this._currLngInterval,e=b.getContext("2d");e.clearRect(0,0,b.width,b.height);e.lineWidth=this.options.weight;e.strokeStyle=this.options.color;e.fillStyle=this.options.fontColor;e.setLineDash(this.options.dashArray);this.options.font&&(e.font=this.options.font);
var p=e.measureText("0").width,y=12;try{var F=e.font.trim().split(" ")[0];y=d(F)}catch(N){}var q=b.width,w=b.height;b=k.containerPointToLatLng(L.point(0,0));F=k.containerPointToLatLng(L.point(q,0));var l=k.containerPointToLatLng(L.point(q,w)).lat,v=b.lat,x=b.lng,u=F.lng;b=(v-l)/(.2*w);if(!isNaN(b)){1>b&&(b=1);l=-90>l?-90:parseInt(l-b,10);v=90<v?90:parseInt(v+b,10);var C=(u-x)/(.2*q);1>C&&(C=1);0<x&&0>u&&(u+=360);u=parseInt(u+C,10);x=parseInt(x-C,10);var t,B,A,H=.5;if(0<D){for(var f=D;f<=v;f+=D)f>=
l&&I(this,f);for(f=0;f>=l;f-=D)f<=v&&I(this,f)}if(0<E){for(f=E;f<=u;f+=E)f>=x&&G(this,f);for(f=0;f>=x;f-=E)f<=u&&G(this,f)}}}},_latLngToCanvasPoint:function(a){var d=this._map;a=d.project(L.latLng(a));a._subtract(d.getPixelOrigin());return L.point(a).add(d._getMapPanePos())}});L.latlngGraticule=function(a){return new L.LatLngGraticule(a)}})(this,document);