myMap.editTools=new L.Editable(myMap,{editable:!0});var tooltip=document.createElement("div");tooltip.style.cssText="display: none; position: absolute; background: #666; color: white; padding: 10px; border: 1px dashed #999; font-family: sans-serif; font-size: 12px; height: 20px; line-height: 20px; z-index: 1000;";document.body.appendChild(tooltip);
function addTooltip(c){L.DomEvent.on(document,"mousemove",moveTooltip);tooltip.innerHTML="Click on the map to start a new route.";tooltip.style.display="block"}function removeTooltip(c){tooltip.innerHTML="";tooltip.style.display="none";L.DomEvent.off(document,"mousemove",moveTooltip)}function moveTooltip(c){tooltip.style.left=c.clientX+20+"px";tooltip.style.top=c.clientY-10+"px"}
function updateTooltip(c){tooltip.innerHTML=c.layer.editor._drawnLatLngs.length<c.layer.editor.MIN_VERTEX?"Click on the map to continue the route.":"Click on last point to finish the route."}myMap.on("editable:drawing:start",addTooltip);myMap.on("editable:drawing:end",removeTooltip);myMap.on("editable:drawing:click",updateTooltip);function coordsToString(c){for(var b="",a=c.length,d=0;d<a;d++){var e=c[d];b=b+"lat:"+e.lat+", lon:"+e.lng;d<a-1&&(b+=" - ")}return b}
function makeEditable(c){var b=window[c];b.enableEdit();b.on("editable:drawing:end",function(a){a=b.getLatLngs();jscallback.updateRoute("editable:drawing:end",c,coordsToString(a))});b.on("editable:vertex:dragend",function(a){a=b.getLatLngs();jscallback.updateRoute("editable:vertex:dragend",c,coordsToString(a))});b.on("editable:vertex:deleted",function(a){b.closeTooltip();a=b.getLatLngs();jscallback.updateRoute("editable:vertex:deleted",c,coordsToString(a))});b.on("editable:vertex:new",function(a){a=
b.getLatLngs();jscallback.updateRoute("editable:vertex:new",c,coordsToString(a))});b.on("editable:vertex:mouseover",function(a){a=a.latlng;jscallback.registerRoute(c,a.lat,a.lng);b.openTooltip(a)});b.on("editable:vertex:mouseout",function(a){a=a.latlng;jscallback.deregisterRoute(c,a.lat,a.lng);b.closeTooltip()});b.on("mouseover",function(a){a=a.latlng;jscallback.registerRoute(c,a.lat,a.lng)});b.on("mouseout",function(a){a=a.latlng;jscallback.deregisterRoute(c,a.lat,a.lng)})};