(function(){L.Routing=L.Routing||{};L.Routing.OpenRouteService=L.Class.extend({options:{serviceUrl:"https://api.openrouteservice.org/directions",timeout:3E4,profile:"driving-car",urlParameters:{}},initialize:function(a,b){this._apiKey=a;L.Util.setOptions(this,b)},route:function(a,b,c,g){var l=!1,h=[],d;g=g||{};g=this.buildRouteUrl(a,g);var m=setTimeout(function(){l=!0;b.call(c||b,{status:-1,message:"OpenRouteService request timed out."})},this.options.timeout);var n=[];for(d=0;d<a.length;d++){var f=
a[d];h.push({latLng:f.latLng,name:f.name,options:f.options});n.push([f.latLng.lng,f.latLng.lat])}corslite(g,L.bind(function(a,d){clearTimeout(m);l||(a?b.call(c||b,{status:-1,message:"HTTP request failed: "+a}):(a=JSON.parse(d.responseText),this._routeDone(a,h,b,c)))},this));return this},_routeDone:function(a,b,c,g){var l=[],h,d,m,n;g=g||c;if(a.routes){for(h=0;h<a.routes.length;h++){var f=a.routes[h];var p=this._decodePolyline(f.geometry);var r=[];var t=[];for(d=m=n=0;d<f.segments.length;d++){var k=
f.segments[d];var q=k.steps;for(k=0;k<q.length;k++){var e=q[k];m+=e.distance;n+=e.duration;e=this._convertInstructions(e,p);0===k&&0===d?e.type="Head":k===q.length-1&&d===f.segments.length-1?e.type="DestinationReached":(e.type=this._typeFromInstruction(e),e.modifier=this._modifierFromInstruction(e));r.push(e);e=p[f.way_points[1]];t.push(e)}}l.push({name:"Routing option "+h,coordinates:p,instructions:r,summary:{totalDistance:m,totalTime:n},inputWaypoints:b,waypoints:t})}c.call(g,null,l)}else c.call(g,
{status:a.type,message:a.details})},_decodePolyline:function(a){a=polyline.fromGeoJSON(a);a=polyline.decode(a,5);var b=Array(a.length),c;for(c=0;c<a.length;c++)b[c]=new L.LatLng(a[c][0],a[c][1]);return b},buildRouteUrl:function(a,b){b=[];var c;for(c=0;c<a.length;c++)b.push(a[c].latLng.lng+"%2C"+a[c].latLng.lat);a=this.options.serviceUrl+"?coordinates="+b.join("%7C");return a+L.Util.getParamString(L.extend({instructions:!0,instructions_format:"text",geometry_format:"geojson",preference:"recommended",
units:"m",maneuvers:!0,profile:this.options.profile,api_key:this._apiKey},this.options.urlParameters),a)},_convertInstructions:function(a,b){return{text:a.instruction,distance:a.distance,time:a.duration,road:a.name,index:a.way_points[0],bearing_before:a.maneuver.bearing_before,bearing_after:a.maneuver.bearing_after,direction:this._bearingToDirection(a.maneuver.bearing_after)}},_bearingToDirection:function(a,b){return"N NE E SE S SW W NW".split(" ")[Math.round(a/45)%8]},_modifierFromHeadings(a,b){a=
b-a;-180>a?a+=360:180<a&&(a-=360);b=0<a?"Right":"Left";a=Math.abs(a);22.5>=a?b="Straight":67.5>=a?b="Slight"+b:112.5>=a||(b=157.5>=a?"Sharp"+b:"Uturn");return b},_typeFromInstruction(a){a=a.text;var b;a.startsWith("Arrive at")?b="WaypointReached":a.startsWith("Enter the roundabout")&&(b="Roundabout");return b},_modifierFromInstruction(a){var b=a.text;b.startsWith("Turn sharp right")?a="SharpRight":b.startsWith("Turn sharp left")?a="SharpLeft":b.startsWith("Turn right")?a="Right":b.startsWith("Turn left")?
a="Left":b.startsWith("Keep right")?a="SlightRight":b.startsWith("Keep left")?a="SlightLeft":b.startsWith("Continue straight")?a="Straight":(b.startsWith("Head")||b.startsWith("Enter the roundabout"),a=this._modifierFromHeadings(a.bearing_before,a.bearing_after));return a}});L.Routing.openrouteservice=function(a,b){return new L.Routing.OpenRouteService(a,b)}})();