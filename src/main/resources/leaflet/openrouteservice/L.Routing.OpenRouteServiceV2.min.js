(function(){L.Routing=L.Routing||{};L.Routing.OpenRouteServiceV2=L.Class.extend({initialize:function(a,f,e){this._apiKey=a;this._orsOptions=f;L.Util.setOptions(this,e)},route:function(a,f,e){var g=[];let m=new Openrouteservice.Directions({api_key:this._apiKey}),h=[];a.forEach(a=>{h.push([a.latLng.lng,a.latLng.lat])});this._orsOptions.coordinates=h;m.calculate(this._orsOptions).then(L.bind(function(a){a=JSON.parse(JSON.stringify(a));this._routeDone(a,g,f,e)},this)).catch(function(a){console.error(a)});
return this},_routeDone:function(a,f,e,g){var m=[],h,k,n,c;g=g||e;if(a.routes){for(h=0;h<a.routes.length;h++){var d=a.routes[h];var b=this._decodePolyline(d.geometry);var q=[];var r=[];for(k=n=c=0;k<d.segments.length;k++){var p=d.segments[k];var t=p.steps;for(p=0;p<t.length;p++){var l=t[p];n+=l.distance;c+=l.duration;l=this._convertInstructions(l,b);q.push(l);l=b[d.way_points[1]];r.push(l)}}m.push({name:"Route: "+(h+1),coordinates:b,instructions:q,summary:{totalDistance:n,totalTime:c},inputWaypoints:f,
waypoints:r})}e.call(g,null,m)}else e.call(g,{status:a.type,message:a.details})},_decodePolyline:function(a,f=!1){let e=[],g=0;const m=a.length;let h=0,k=0,n=0;for(;g<m;){let d=0,b=0;do{var c=a.charAt(g++).charCodeAt(0)-63;b|=(c&31)<<d;d+=5}while(32<=c);h+=0!==(b&1)?~(b>>1):b>>1;b=d=0;do c=a.charAt(g++).charCodeAt(0)-63,b|=(c&31)<<d,d+=5;while(32<=c);k+=0!==(b&1)?~(b>>1):b>>1;if(f){b=d=0;do c=a.charAt(g++).charCodeAt(0)-63,b|=(c&31)<<d,d+=5;while(32<=c);n+=0!==(b&1)?~(b>>1):b>>1}try{c=[h/1E5,k/1E5],
f&&c.push(n/100),e.push(c)}catch(q){console.log(q)}}return e},_convertInstructions:function(a,f){return{text:a.instruction,distance:a.distance,time:a.duration,index:a.way_points[0]}}});L.Routing.openrouteserviceV2=function(a,f,e){return new L.Routing.OpenRouteServiceV2(a,f,e)}})();