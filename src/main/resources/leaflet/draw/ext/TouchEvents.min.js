L.Map.mergeOptions({touchExtend:!0});
L.Map.TouchExtend=L.Handler.extend({initialize:function(a){this._map=a;this._container=a._container;this._pane=a._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this);L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this);L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this);this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,
this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart);L.DomEvent.off(this._container,"touchend",this._onTouchEnd);L.DomEvent.off(this._container,"touchmove",this._onTouchMove);
this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDowm",this._onTouchStart),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave))},_touchEvent:function(a,b){if("undefined"!==typeof a.touches){if(!a.touches.length)return;
var c=a.touches[0]}else if("touch"===a.pointerType){if(c=a,!this._filterClick(a))return}else return;var e=this._map.mouseEventToContainerPoint(c),d=this._map.mouseEventToLayerPoint(c),f=this._map.layerPointToLatLng(d);this._map.fire(b,{latlng:f,layerPoint:d,containerPoint:e,pageX:c.pageX,pageY:c.pageY,originalEvent:a})},_filterClick:function(a){var b=a.timeStamp||a.originalEvent.timeStamp,c=L.DomEvent._lastClick&&b-L.DomEvent._lastClick;if(c&&100<c&&500>c||a.target._simulatedClick&&!a._simulated)return L.DomEvent.stop(a),
!1;L.DomEvent._lastClick=b;return!0},_onTouchStart:function(a){this._map._loaded&&this._touchEvent(a,"touchstart")},_onTouchEnd:function(a){this._map._loaded&&this._touchEvent(a,"touchend")},_onTouchCancel:function(a){if(this._map._loaded){var b="touchcancel";this._detectIE()&&(b="pointercancel");this._touchEvent(a,b)}},_onTouchLeave:function(a){this._map._loaded&&this._touchEvent(a,"touchleave")},_onTouchMove:function(a){this._map._loaded&&this._touchEvent(a,"touchmove")},_detectIE:function(){var a=
window.navigator.userAgent,b=a.indexOf("MSIE ");if(0<b)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);if(0<a.indexOf("Trident/"))return b=a.indexOf("rv:"),parseInt(a.substring(b+3,a.indexOf(".",b)),10);b=a.indexOf("Edge/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):!1}});L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend);
L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var a=this._icon,b="dblclick mousedown mouseover mouseout contextmenu touchstart touchend touchmove".split(" ");this._detectIE?b.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):b.concat(["touchcancel"]);L.DomUtil.addClass(a,"leaflet-clickable");
L.DomEvent.on(a,"click",this._onMouseClick,this);L.DomEvent.on(a,"keypress",this._onKeyPress,this);for(var c=0;c<b.length;c++)L.DomEvent.on(a,b[c],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var a=window.navigator.userAgent,b=a.indexOf("MSIE ");if(0<b)return parseInt(a.substring(b+5,a.indexOf(".",b)),10);if(0<a.indexOf("Trident/"))return b=a.indexOf("rv:"),parseInt(a.substring(b+
3,a.indexOf(".",b)),10);b=a.indexOf("Edge/");return 0<b?parseInt(a.substring(b+5,a.indexOf(".",b)),10):!1}});